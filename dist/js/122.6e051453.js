"use strict";(self["webpackChunklite"]=self["webpackChunklite"]||[]).push([[122],{3122:function(e,t,s){s.r(t),s.d(t,{default:function(){return C}});var i=s(1032),n=s(4746),l=function(){var e=this,t=e._self._c;return t("lay-header",{attrs:{showBack:!e.isEditMode,showX:e.isEditMode,tBarColor:"#FFFFFF",txtRight:e.isEditMode?e.items.length==e.selectItems.length?e.$t("common.select-none"):e.$t("common.select-all"):e.$t("common.select"),onBack:()=>{e.isEditMode?e.isEditMode=!1:e.$router.go(-1)},onRight:e.onClickActionEdit,isGetingItems:e.isGetingItems}},[e.gallInfo?t(i.A,{staticClass:"pt-5 lay-body",attrs:{column:""}},[t(i.A,{staticClass:"lay-date px-5",attrs:{"align-center":""}},[t("span",{staticClass:"txt-num"},[e._v("#"+e._s(e.gallInfo.logId))]),t("span",{staticClass:"txt-date"},[e._v(" "+e._s(e.$t("common.yyyyMM",{year:e.gallInfo.startDate.substring(0,4),month:e.gallInfo.startDate.substring(4,6)}))+" ")]),e.gallInfo.majorLocation?t(i.A,[t("img",{staticClass:"ml-2",attrs:{src:s(2045)}}),t("span",{staticClass:"txt-loc"},[e._v(e._s("en"==e.$i18n.locale?e.gallInfo.majorLocationEn:e.gallInfo.majorLocation))])]):e._e()],1),t(i.A,{staticClass:"flex-grow-0 pb-5 pt-3",attrs:{wrap:"",row:""}},e._l(e.items,(function(s,i){return t("c-pic",{key:i,attrs:{editMode:e.isEditMode,src:("VIDEO"==s.fileType?s.thumbName:s.fileName)+`?${e.filterVer}`,isVideo:"VIDEO"==s.fileType,duration:s.videoTime,select:e.selectItems.indexOf(s)>-1?e.selectItems.indexOf(s)+1:null,isLike:"Y"==s.likeYn,isFilter:"1"==s.filterd,isMemo:s.memo.title||s.memo.memo,onClick:()=>e.onClickActionSelect(s),mediaId:s.mediaId}})})),1),t("transition",{attrs:{name:"slide-y-reverse-transition"}},[e.isEditMode?t("c-footer",{attrs:{height:"80",elevation:"0"}},[t(i.A,{directives:[{def:n.A,name:"ripple",rawName:"v-ripple"}],staticClass:"lay-footer-menu",class:[e.selectItems.length?"select":""],attrs:{column:"","align-center":"","justify-center":""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onClickActionSave.apply(null,arguments)}}},[t("img",{attrs:{src:s(4830)}}),t("span",[e._v(e._s(e.$t("common.save")))])]),t(i.A,{directives:[{def:n.A,name:"ripple",rawName:"v-ripple"}],staticClass:"lay-footer-menu",class:[e.selectItems.length?"select":""],attrs:{column:"","align-center":"","justify-center":""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onClickActionFilter.apply(null,arguments)}}},[t("img",{attrs:{src:s(7364)}}),t("span",[e._v(e._s(e.$t("common.filter")))])]),t(i.A,{directives:[{def:n.A,name:"ripple",rawName:"v-ripple"}],staticClass:"lay-footer-menu",class:[e.selectItems.length?"select":""],attrs:{column:"","align-center":"","justify-center":""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onClickActionDel.apply(null,arguments)}}},[t("img",{attrs:{src:s(2769)}}),t("span",[e._v(e._s(e.$t("common.delete")))])])],1):e._e()],1)],1):e._e()],1)},o=[],c=(s(4114),s(3004)),r=s(1877),a=s(3776),m=s(8414),h=s.n(m),d=s(7488);const u={request:async e=>{let t={isSuccess:!1,errorMsg:"",data:null},s=`   \n            SELECT \n                *\n            FROM \n                TB_LOG \n            WHERE\n                logId = ${e}\n        `;return new Promise(((e,i)=>{const n=`API_GETINFO_CALLBACK_${h()().replace(/-/gi,"")}`;d.A.sqlite(JSON.stringify({cmd:"selectQuery",query:s}),n),window[`${n}`]=s=>{try{if(s){const i=JSON.parse(s);t.isSuccess=i.result,t.errorMsg=i.error,t.data=i.data&&i.data.length>0?i.data[0]:null,e(t)}else i()}catch(l){i(l)}delete window[`${n}`]}}))}};var g=u,p=(s(8197),{components:{cFooter:c.A,CPic:r.A},props:["seq"],data(){return{isGetingItems:!1,isEditMode:!1,selectItems:[],items:[],pageNo:1,allCount:0,gallInfo:null}},computed:{},watch:{isEditMode(){this.selectItems.splice(0,this.selectItems.length)}},created(){window.addEventListener("scroll",this.handleScroll)},mounted(){this.getData()},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{async getData(){if(this.isGetingItems)return;this.isGetingItems=!0;let e=await g.request(this.seq);this.isGetingItems=!1,e.isSuccess?(this.gallInfo=e.data,this.getItems()):this.showToast(this.$t("error.error"),!1,!1)},async getItems(e=1){if(!this.isGetingItems){this.isGetingItems=!0;var t=[];this.seq&&t.push({key:"logId",val:this.seq}),await a.A.request(e,20,t).then((t=>{this.pageNo=e,1==e&&this.items.splice(0,this.items.length),this.allCount=t.allCount,this.items.push(...t.list),this.isGetingItems=!1,this.items.forEach((e=>{try{this.$set(e,"memo",JSON.parse(e.memo.replace(/\n/g,"\\n")))}catch(t){}})),setTimeout((()=>{var e=document.children[0];this.checkNext(e)}),300)})).catch((()=>{this.isGetingItems=!1}))}},handleScroll(e){let t=e.target.children[0];this.checkNext(t)},checkNext(e){this.items.length<this.allCount&&e&&e.scrollHeight-e.clientHeight-80<e.scrollTop&&this.getItems(this.pageNo+1)},checkSelect(){return!!this.selectItems.length},onClickActionEdit(){this.isEditMode?this.items.length==this.selectItems.length?this.selectItems.splice(0,this.selectItems.length):this.items.forEach((e=>{this.selectItems.indexOf(e)<0&&this.selectItems.push(e)})):this.isEditMode=!0},onClickActionSelect(e){this.isEditMode?this.selectItems.indexOf(e)>-1?this.selectItems.splice(this.selectItems.indexOf(e),1):this.selectItems.push(e):this.pushRouter({name:"media",params:{seq:e.mediaId,logId:e.logId}})},onClickActionSave(){if(this.checkSelect()){if(this.isGetingItems)return;this.isGetingItems=!0,window.onSaveComplete=()=>{this.isEditMode=!1,this.isGetingItems=!1,"success"==res?this.showToast(this.$t("error.save-comp")):this.showToast(this.$t("error.error"),!1,!1),delete window.onSaveComplete},this.nativeBridge.fileDownload(this.selectItems,"onSaveComplete")}},onClickActionFilter(){if(this.selectItems.length>this.FILTER_MAX_SIZE)return this.showToast(this.$t("error.filter-cnt-error",{count:this.FILTER_MAX_SIZE}),!1,!1),!1;this.checkSelect()&&(window.onFilterComplete=e=>{e&&(this.showToast(this.$t("error.filter-comp"),!1,!1),this.$store.commit("filterVer",this.filterVer+1),this.getItems()),this.isEditMode=!1,delete window.onFilterComplete},this.nativeBridge.showFilterView(this.selectItems,"onFilterComplete"))},onClickActionDel(){this.checkSelect()&&this.showPopup({title:this.$t("gallery.edit.select",{count:this.selectItems.length}),msg:this.$t("gallery.edit.delect-desc"),okTxt:this.$t("common.delete"),cancelTxt:this.$t("common.cancel"),okAction:()=>{window.onDeleteComplete=()=>{this.isEditMode=!1,this.getItems(),delete window.onDeleteComplete},this.nativeBridge.fileDelete(this.selectItems,"onDeleteComplete")}})}}}),I=p,f=s(1656),E=(0,f.A)(I,l,o,!1,null,"3e72717b",null),C=E.exports},3776:function(e,t,s){var i=s(8414),n=s.n(i),l=s(7488),o=s(7334);const c={request:async(e=1,t=20,s,i)=>{let c={isSuccess:!1,errorMsg:"",list:null,allCount:0},r="\n            SELECT \n                COUNT(*) AS cnt \n            FROM \n                TB_MEDIA \n            WHERE \n                deleted = 0\n        ",a="\n            SELECT \n               *\n            FROM \n               (\n                    SELECT \n                        m.*,\n                        CASE WHEN(COUNT(cm.collectionMediaId) > 0) THEN 'Y' ELSE 'N' END as likeYn\n                    FROM \n                        TB_MEDIA m\n                    LEFT JOIN\n                        TB_COLLECTION_MEDIA cm\n                    ON\n                        m.mediaId = cm.mediaId \n                        AND cm.collectionId = 1 \n                        AND cm.deleted = 0\n                    GROUP BY\n                        m.mediaId\n                )\n            WHERE \n                deleted = 0\n        ";if(s&&s.length&&s.forEach((e=>{a+=` AND ${e.key} = '${e.val}' `,r+=` AND ${e.key} = '${e.val}' `})),i){let e=`\n                AND mediaId NOT IN (\n                    SELECT \n                        mediaId\n                    FROM\n                        TB_COLLECTION_MEDIA\n                    WHERE \n                        deleted = 0\n                    AND \n                        collectionId = ${i}\n                )\n            `;a+=e,r+=e}a+=`   \n            ORDER BY \n                createDate DESC\n            LIMIT ${t} OFFSET ${t*(e-1)}\n        `;try{c.allCount=await o.A.request(r,"cnt")}catch(m){return Promise.reject(m)}return new Promise(((e,t)=>{const s=`API_GETLIST_CALLBACK_${n()().replace(/-/gi,"")}`;l.A.sqlite(JSON.stringify({cmd:"selectQuery",query:a}),s),window[`${s}`]=i=>{try{if(i){const t=JSON.parse(i);c.isSuccess=t.result,c.errorMsg=t.error,c.list=t.data,e(c)}else t()}catch(m){t(m)}delete window[`${s}`]}}))}};t.A=c},2045:function(e,t,s){e.exports=s.p+"img/ic-location-g.35a8f128.svg"},2769:function(e,t,s){e.exports=s.p+"img/ic-menu-del.a80b8317.svg"},4830:function(e,t,s){e.exports=s.p+"img/ic-menu-down.d94443e1.svg"},7364:function(e,t,s){e.exports=s.p+"img/ic-menu-filter.3954c3d4.svg"}}]);
//# sourceMappingURL=122.6e051453.js.map