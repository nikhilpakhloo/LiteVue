"use strict";(self["webpackChunklite"]=self["webpackChunklite"]||[]).push([[986],{9986:function(t,e,s){s.r(e),s.d(e,{default:function(){return A}});var i=s(1032),n=function(){var t=this,e=t._self._c;return e("lay-header",{attrs:{showBack:!0,tBarColor:"#FFFFFF",txtRight:t.$t("common.done"),txtTitle:t.$t("collection.pics.title"),onRight:t.onClickActionComp}},[e(i.A,{staticClass:"lay-body",attrs:{column:""}},[e("span",{staticClass:"txt-cnt pt-1 pb-4 px-5",staticStyle:{"overflow-wrap":"'everything'"}},[t._v(t._s(t.$t("collection.pics.desc",{count:t.selectItems.length,title:t.title})))]),e(i.A,{staticClass:"flex-grow-0 pb-5",attrs:{wrap:"",row:""}},t._l(t.items,(function(s,i){return e("c-pic",{key:i,attrs:{editMode:!0,src:s.thumbName+`?${t.filterVer}`,isVideo:"VIDEO"==s.fileType,duration:s.videoTime,select:t.selectItems.indexOf(s.mediaId)>-1?t.selectItems.indexOf(s.mediaId)+1:null,isLike:"Y"==s.likeYn,isFilter:"1"==s.filterd,isMemo:s.memo.title||s.memo.memo,onClick:()=>t.onClickActionSelect(s.mediaId)}})})),1)],1)],1)},r=[],l=(s(4114),s(1877)),c=s(3776),o=s(8414),a=s.n(o),h=s(7488),d=s(3171);const m={request:async t=>{let e={isSuccess:!1,errorMsg:"",data:null},s=`   \n            INSERT INTO \n                TB_COLLECTION\n            VALUES (\n                NULL,\n                '${(0,d.cA)()}',\n                '${t}',\n                0,\n                0,\n                strftime('%Y%m%d%H%M%S', 'now', 'localtime'),\n                0\n            ) \n        `;try{var i=await new Promise(((t,e)=>{const i=`API_GETINFO_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"runQuery",query:s}),i),window[`${i}`]=s=>{try{s?t(s):e()}catch(n){e(n)}delete window[`${i}`]}}));if(JSON.parse(i).result)return new Promise(((t,s)=>{let i="\n                        SELECT \n                            collectionId \n                        FROM \n                            TB_COLLECTION \n                        WHERE \n                            deleted = 0 \n                        ORDER BY \n                            collectionId DESC \n                        LIMIT 1\n                    ";const n=`API_GETID_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"selectQuery",query:i}),n),window[`${n}`]=i=>{try{if(i){const s=JSON.parse(i);e.isSuccess=s.result,e.errorMsg=s.error,e.data=s.data&&s.data.length>0?s.data[0]:s.data,t(e)}else s()}catch(r){s(r)}delete window[`${n}`]}}));throw"error"}catch(n){throw n}}};var u=m;const I={request:async(t,e)=>{let s={isSuccess:!1,errorMsg:"",data:null},i="";e.forEach((e=>{i&&(i+=" UNION "),i+=`\n                SELECT\n                    NULL,\n                    ${t},\n                    ${e},\n                    0,\n                    strftime('%Y%m%d%H%M%S', 'now', 'localtime'),\n                    0\n            `}));let n=`   \n            INSERT INTO \n                TB_COLLECTION_MEDIA\n            ${i}\n        `;return new Promise(((t,e)=>{const i=`API_GETINFO_CALLBACK_${a()().replace(/-/gi,"")}`;h.A.sqlite(JSON.stringify({cmd:"runQuery",query:n}),i),window[`${i}`]=n=>{try{if(n){const e=JSON.parse(n);s.isSuccess=e.result,s.errorMsg=e.error,s.data=e.data,t(s)}else e()}catch(r){e(r)}delete window[`${i}`]}}))}};var E=I,g=s(3548),C={props:["title","seq"],data(){return{isGetingItems:!1,isEditMode:!1,selectItems:[],items:[],pageNo:1,allCount:0,gallInfo:null}},computed:{},watch:{isEditMode(){this.selectItems.splice(0,this.selectItems.length)}},created(){window.addEventListener("scroll",this.handleScroll)},mounted(){this.seq?this.getData():this.getItems()},destroyed(){window.removeEventListener("scroll",this.handleScroll)},methods:{async getData(){if(this.isGetingItems)return;this.isGetingItems=!0;let t=await g.A.request(this.seq);this.isGetingItems=!1,t.isSuccess?(this.title=1==t.data.favorite?this.$t("collection.like"):t.data.collectionName,this.getItems()):(this.showToast(this.$t("error.error"),!1,!1),this.$router.go(-1))},async getItems(t=1){this.isGetingItems||(this.isGetingItems=!0,await c.A.request(t,20,null,this.seq).then((e=>{this.isGetingItems=!1,this.pageNo=t,1==t&&this.items.splice(0,this.items.length),this.allCount=e.allCount,this.items.push(...e.list),this.items.forEach((t=>{try{this.$set(t,"memo",JSON.parse(t.memo.replace(/\n/g,"\\n")))}catch(e){}})),setTimeout((()=>{var t=document.children[0];this.checkNext(t)}),300)})).catch((()=>{this.isGetingItems=!1})))},handleScroll(t){let e=t.target.children[0];this.checkNext(e)},checkNext(t){this.items.length<this.allCount&&t&&t.scrollHeight-t.clientHeight-80<t.scrollTop&&this.getItems(this.pageNo+1)},async insertCollection(t){this.selectItems&&this.selectItems.length?await E.request(t,this.selectItems).then((t=>{this.isGetingItems=!1,t.isSuccess?(this.showToast(this.$t("error.save-comp"),!0,!1),this.$router.go(this.seq?-1:-2)):this.showToast(this.$t("error.error"),!1,!1)})).catch((()=>{this.isGetingItems=!1})):(this.isGetingItems=!1,this.showToast(this.$t("error.save-comp"),!0,!1),this.$router.go(this.seq?-1:-2))},async onClickActionComp(){this.isGetingItems||(this.isGetingItems=!0,this.seq?this.insertCollection(this.seq):await u.request(this.title).then((t=>{t.isSuccess?this.insertCollection(t.data.collectionId):this.isGetingItems=!1})).catch((()=>{this.isGetingItems=!1})))},onClickActionSelect(t){this.selectItems.indexOf(t)>-1?this.selectItems.splice(this.selectItems.indexOf(t),1):this.selectItems.push(t)}},components:{CPic:l.A}},w=C,N=s(1656),O=(0,N.A)(w,n,r,!1,null,"570fd43e",null),A=O.exports},3548:function(t,e,s){var i=s(8414),n=s.n(i),r=s(7488);const l={request:async t=>{let e={isSuccess:!1,errorMsg:"",data:null},s=`   \n            SELECT \n                *\n            FROM \n                TB_COLLECTION \n            WHERE\n                collectionId = ${t}\n        `;return new Promise(((t,i)=>{const l=`API_GETINFO_CALLBACK_${n()().replace(/-/gi,"")}`;r.A.sqlite(JSON.stringify({cmd:"selectQuery",query:s}),l),window[`${l}`]=s=>{try{if(s){const i=JSON.parse(s);e.isSuccess=i.result,e.errorMsg=i.error,e.data=i.data&&i.data.length>0?i.data[0]:null,t(e)}else i()}catch(n){i(n)}delete window[`${l}`]}}))}};e.A=l},3776:function(t,e,s){var i=s(8414),n=s.n(i),r=s(7488),l=s(7334);const c={request:async(t=1,e=20,s,i)=>{let c={isSuccess:!1,errorMsg:"",list:null,allCount:0},o="\n            SELECT \n                COUNT(*) AS cnt \n            FROM \n                TB_MEDIA \n            WHERE \n                deleted = 0\n        ",a="\n            SELECT \n               *\n            FROM \n               (\n                    SELECT \n                        m.*,\n                        CASE WHEN(COUNT(cm.collectionMediaId) > 0) THEN 'Y' ELSE 'N' END as likeYn\n                    FROM \n                        TB_MEDIA m\n                    LEFT JOIN\n                        TB_COLLECTION_MEDIA cm\n                    ON\n                        m.mediaId = cm.mediaId \n                        AND cm.collectionId = 1 \n                        AND cm.deleted = 0\n                    GROUP BY\n                        m.mediaId\n                )\n            WHERE \n                deleted = 0\n        ";if(s&&s.length&&s.forEach((t=>{a+=` AND ${t.key} = '${t.val}' `,o+=` AND ${t.key} = '${t.val}' `})),i){let t=`\n                AND mediaId NOT IN (\n                    SELECT \n                        mediaId\n                    FROM\n                        TB_COLLECTION_MEDIA\n                    WHERE \n                        deleted = 0\n                    AND \n                        collectionId = ${i}\n                )\n            `;a+=t,o+=t}a+=`   \n            ORDER BY \n                createDate DESC\n            LIMIT ${e} OFFSET ${e*(t-1)}\n        `;try{c.allCount=await l.A.request(o,"cnt")}catch(h){return Promise.reject(h)}return new Promise(((t,e)=>{const s=`API_GETLIST_CALLBACK_${n()().replace(/-/gi,"")}`;r.A.sqlite(JSON.stringify({cmd:"selectQuery",query:a}),s),window[`${s}`]=i=>{try{if(i){const e=JSON.parse(i);c.isSuccess=e.result,c.errorMsg=e.error,c.list=e.data,t(c)}else e()}catch(h){e(h)}delete window[`${s}`]}}))}};e.A=c}}]);
//# sourceMappingURL=986.f45b869c.js.map